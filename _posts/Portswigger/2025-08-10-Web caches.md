---
title: Web caches
date: 2025-05-19
categories: [Portswigger, Web cache deception]
tags: [web]
---

# Web caches
### 웹 캐시가 뭔지?
- 웹 캐시는 서버와 유저 사이에 위치하는 시스템
- 클라이언트가 자원 요청을 보내면 일단 캐시로 그 요청이 가고 캐시에 해당 자원의 사본이 없으면 원본 서버까지 그 요청이 도달하게 되는 것! (캐시 미스)
	- 응답 또한 유저에게 가기 전에 캐시를 거치게 됨
	- 캐시는 미리 정의된 규칙에 따라 그 응답을 저장할지 결정하게 됨
![](assets/images/posts/2025-08-10-Web%20caches/2b28d9484bcb42eef4d31ad8a3e57da1_MD5.jpeg)
- 후에 동일한 자원에 대한 요청이 들어오면 캐시는 저장해 둔 사본을 응답에 사용하게 됨 (캐시 히트)
### 이걸 왜 쓰는지? 
- 전 세계의 서버에 그 사본을 분산 저장해 두는 CDN에 있어서 캐싱은 웹 컨텐츠 전송에 있어 매우 중요하고 널리 쓰이는 기술임
	- 사용자와 가까운 서버에서 컨텐츠를 제공하기 때문에 load time을 줄일 수 있음
# Cache keys
- 캐시가 HTTP 요청을 받으면 바로 전송할 수 있도록 캐시된 응답이 있는지, 아니면 서버에까지 요청을 해야 할지 결정해야 함
- 캐시는 HTTP 요청의 요소로부터 'Cache keys'를 생성해서 결정을 함
- 그 요소에는 URL 경로나 쿼리 파라미터가 있을 수 있고 헤더나 컨텐츠 타입 요소 또한 고려될 수 있음
- 즉! ==요소로부터 캐시 키를 만든 후==, 키를 바탕으로 캐시에서 내용 꺼내줄지, 서버까지 요청 보낼지 ==결정==한다는 말
- e.g. 리퀘스트의 캐시 키를 생성했는데 이게 이전의 리퀘스터 캐시 키와 같다면 캐시는 동일한 요청으로 보고 캐시에 저장되어 있던 응답을 꺼내 주는 것! 
- ~~캐시 키 manipulate로 악성 컨텐츠 넣는 건 Web Cache Poisoning Academy topic에서 확인할 수 있음~~
# Cache rules 
- 캐시 룰은 어떤 response를, 얼마나 캐시에 가지고 있을지 결정하는 것
- 자주 바뀌지 않고, 다수의 페이지에 걸쳐 재사용할 수 있도록 정적인 자원을 저장하도록 규정됨
- 동적 컨텐츠는 대개 민감한 정보를 가지기 때문에 캐시에 저장되지 않고 사용자가 직접 서버에서 정보를 받음
- 웹 캐시 디셉션 공격은 캐시 룰이 적용되는 방법에 있어서 악용하는 공격
	- 여러 유형의 룰, 요청 URL 경로에 정의된 문자열 등을 잘 아는 것이 중요함
		- 정적 파일 확장자 룰 : 파일 확장자와 관련
		- 정적 디렉터리 룰 : URL 경로에서 디렉터리 타겟
		- 파일 네임 룰 