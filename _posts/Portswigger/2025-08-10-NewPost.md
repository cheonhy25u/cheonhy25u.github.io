---
title: Constructing a web cache deception attack
date: 2025-05-19
categories:
  - Portswigger
  - Web cache deception
tags:
  - web
---
# Constructing a web cache deception attack
기본적인 웹 캐시 디셉션 공격은 다음 단계를 따름
1. 타겟 엔드포인트 식별
	- 민감한 정보가 담긴 동적 응답을 반환하는 대상 엔드포인트 식별
	- 일부 민감한 정보는 rendered page에서 보이지 않을 수 있으므로 Burp에서 응답들을 검토할 것
	- 원본 서버의 상태를 변경하는 요청은 캐시되지 않기 때문에  GET, HEAD, OPTIONS 메소드를 지원하는 엔드포인트는 주의깊게 살펴보아야 함
2. 캐시와 오리진 서버의 URL 경로 해석 차이 파악
	- 원본 서버와 캐시에서 URL 경로를 파싱하는 방법이 어떻게 다른지 살펴봐야 함
		- URL이랑 자원을 매핑하는 방법
		- 구분자의 처리 방식
		- 경로 정규화 등
3. 악의적 URL 조작 및 캐싱 유도
	- 2번 과정에서 파악한 차이를 바탕으로 캐시가 민감정보를 포함하는 동적 응답을 저장하도록 악의적인 URL을 생성함
	- victim이 해당 URL에 접근하면 그 응답이 캐시에 저장됨
	- Burp를 사용해서 똑같은 URL로 재요청 시, 캐시에 저장되어 있는 피해자 세션 정보가 포함된 응답을 받을 수 있음
# Using a cache buster
- 웹 캐시 디셉션 공격을 위해서는 보내는 각 요청마다 캐시 키가 서로 달라야 함 
	- 같은 키를 가지는 요청을 보내면 이전 요청의 캐시된 응답이 반환되기 때문에 테스트에 영향을 줌
- 일반적으로 캐시 키에는 URL 경로, 쿼리 파라미터가 포함되므로 경로 뒤에 쿼리 스트링을 추가하고 매 요청마다 값을 바꾸면 캐시 키는 달라짐 
- Param Miner 익스텐션을 통해 자동화 가능
	1. Param Miner 확장 프로그램 설치 
	2. Burp 상단 메뉴 Param Miner -> Settings / Add dynamic cachebuster 옵션 선택
	- 이렇게 되면 보내는 모든 요청에 Burp가 고유한 쿼리 스트링을 추가함 
# Detecting cached responses
- 테스팅 중에는 응답이 캐시에서 온 것인지 식별하는 게 중요함
	- 응답 헤더, 응답 시간을 보고 식별할 수 있음
- `X-Cache` 헤더를 통해 응답이 캐시에서 제공되었는지 여부를 알 수 있음
	- `X-Cache : hit` -> 응답이 캐시에서 제공됨
	- `X-Cache : miss` -> 해당 요청 키에 대해 캐시에 응답이 없어 원본 서버에서 가져왔음
		- 이 경우 가져온 데이터는 캐시에 저장됨
		- 동일 요청 다시 보내 값이 hit로 바뀌는지 확인
	- `X-Cache : dynamic` -> 원본 서버가 콘텐츠를 동적으로 생성했음
		- 이 경우 캐싱이 적합하지 않음
	- `X-Cache : refresh` -> 기존 캐시된 콘텐츠가 오래되어 갱신 또는 재검증이 필요했음
- `Cache-Control` 헤더는 캐시 지시어를 포함할 수 있음
	- public과 max-age가 0보다 큰 값으로 설정되어 있으면 캐시 가능하다는 뜻
	- 캐시 가능성을 의미할 뿐, 실제로 캐시에 저장되었는지 보장하지는 않음
- 동일한 요청 여러번 보냈을 때 응답 시간에 큰 차이가 있으면 더 빠른 응답이 캐시에서 제공된 것일 수 있음


